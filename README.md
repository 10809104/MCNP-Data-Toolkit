# MCNP Data Toolkit v2.5

**MCNP Data Toolkit** 是一款專為處理 MCNP 輸出檔案（`.o` 檔）所設計的自動化整合工具。本工具能夠自動解析指定資料夾內的 Tally 數據，與 `source.csv` 的原始參數進行橫向合併，並最終透過 PowerShell 腳本將多個資料夾的結果彙整為一份美觀的 Excel 分頁報表。

## 🚀 核心功能

1. **批次處理能力**：支援同時選取多個資料夾，一鍵完成所有數據提取。
2. **智能數據解析**：
* 自動偵測 `nps`（歷史粒子數）與 `tally` 區塊。
* 具備「數據校準」功能，能自動剔除無效或空白的標籤欄位。
* 支援動態記憶體管理，適應不同行數與欄位的數據規模。


3. **GUI 互動介面**：提供 Windows 視窗讓使用者輕鬆勾選目標目錄，並附帶即時主控台（Console）進度顯示。
4. **Excel 自動化美化**：
* 將多個資料夾的 `Final_Report.csv` 整合為單一 `.xlsx` 檔。
* 自動將字體設定為 **Times New Roman**。
* 智慧型底色標註（Row 2 自動上色）與欄寬自動調整。



## 📁 檔案結構說明

* **`main.c`**: 程式進入點，負責 Win32 GUI 視窗建立、資料夾掃描與批次處理邏輯。
* **`tool.h`**: 核心演算法庫，包含 CSV 讀寫、`.o` 檔案解析（狀態機解析）、檔案排序與報告匯出。
* **`config.h`**: 定義資料結構（`DynamicTable`, `Cell`, `FileInfo`）與記憶體初始化/釋放函式。
* **`merge.ps1`**: PowerShell 腳本，利用 Excel COM 物件進行多檔案彙整與格式美化。
* **`source.csv`**: 使用者提供的基礎參數表（必須包含前兩欄作為對照基準）。

## 🛠️ 安裝與編譯環境

* **作業系統**：Windows (支援 Win32 API)
* **編譯器**：建議使用 Dev-C++、MinGW 或 GCC (Windows 版本)。
* *注意：需連結 `comdlg32`, `shell32`, `gdi32` 等函式庫。*


* **依賴需求**：
* 執行 Excel 整合功能需安裝 **Microsoft Excel**。
* PowerShell 執行策略需允許運行（程式會自動嘗試 Bypass）。



## 📖 使用手冊

### 第一步：準備資料

將你的執行檔放在根目錄，結構如下：

```text
/Project/
├── main.exe           # 編譯後的執行檔
├── merge.ps1          # 整合腳本
├── source.csv         # 必要的基礎對照表
├── Folder_A/          # 數據資料夾 A
│   └── *.o            # MCNP 輸出檔
└── Folder_B/          # 數據資料夾 B
    └── *.o

```

### 第二步：執行程式

1. 啟動程式後，若根目錄無 `source.csv`，系統會跳出視窗請你選取來源檔。
2. 在 GUI 視窗的清單中，按住 **Ctrl** 或 **Shift** 選取你想要處理的資料夾。
3. 點擊 **「批次處理」**。

### 第三步：生成報告

1. 處理完成後，各資料夾內會生成 `Final_Report.csv`。
2. 系統會詢問是否執行 Excel 整合。點擊「是」後，稍等片刻即可在根目錄獲得 **`MRCP_Total_Summary.xlsx`**。

## ⚠️ 注意事項

* **編碼**：匯出的 CSV 檔案帶有 UTF-8 BOM，確保 Excel 開啟時中文不亂碼。
* **檔名規則**：工具會嘗試從檔名提取數值（例如 `AP-0.01.o` 提取 `0.01`），請保持檔名格式一致以獲得最佳報表效果。
* **記憶體管理**：程式內建嚴謹的 `free` 邏輯，但若處理極大規模數據（如數萬行），請監控系統記憶體。

---

**KikKoh @2026 版權所有**
